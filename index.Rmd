---
title: "Untitled"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(rio)
library(here)
library(janitor)
library(cowplot)
library(colorblindr)
```


Column {data-width=650}
-----------------------------------------------------------------------


### Chart A

```{r fig.width=14, fig.height=6}
earnings <- import(here::here("data", "Earnings_state.xlsx")) %>% 
  characterize() %>% 
  clean_names()
  
earnings <- na_if(earnings, "n/a")
earnings$non_industry <- as.double(earnings$non_industry)
earnings$correctional_industry <- as.double(earnings$correctional_industry)


p1 <- ggplot(earnings, aes(state, non_industry)) +
  geom_line(aes(group = state)) +
  geom_point(aes(color = bookend), show.legend = FALSE) +
  ylim(0,5.15) +
  coord_flip() + 
  labs(title = "Range of Earnings Offered to Incarcerated People in Non-industry Jobs", 
       x = "State", 
       y = "Wage per hour", 
       caption = "Data from Sawyer (2017). https://www.prisonpolicy.org/blog/2017/04/10/wages/") + 
  theme_minimal()

p2 <- ggplot(earnings, aes(state, correctional_industry)) +
  geom_line(aes(group = state)) +
  geom_point(aes(color = bookend), show.legend = FALSE) +
  coord_flip() + 
  labs(title = "Range of Earnings Offered to Incarcerated People in Correctional Industry Jobs", 
       x = "State", 
       y = "Wage per hour", 
       caption = "Data from Sawyer (2017). https://www.prisonpolicy.org/blog/2017/04/10/wages/") + 
  theme_minimal()

plot_grid(p1, p2)


```


Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
incar <- import(here::here("data", "incarceration_rates_by_type.csv")) %>% 
  characterize() %>% 
  clean_names()
  
incar <- incar[-c(93:16383), ]

incar %>% 
  pivot_longer(cols = state_prisons:local_jails) %>%
  ggplot(aes(year, value, group = name)) +
  geom_line(aes(color = name)) +
  scale_color_OkabeIto() +
  labs(y = "Incarceration Rates", x = "Year", title = "Rates of Incarceration per 100,000 people", caption = "Data compiled by the Prison Policy Initiative. https://www.prisonpolicy.org/data/") + 
  scale_color_discrete(name = "Institution", labels = c("Federal Prisons", "Local Jails", "State Prisons")) +
  theme_minimal()
```

### Chart C

```{r}
states <- import(here::here("data", "State_rates_time.xlsx")) %>% 
  characterize() %>% 
  clean_names()
  
#remotes::install_github("hrbrmstr/albersusa")
library(albersusa)
us <- usa_sf() %>% 
  mutate(
    state = factor(name))

states_prison <- states %>% 
  filter(institution == "Prison Rate")

states_prison <- states_prison %>% 
  mutate(factor(state))

data_map <- left_join(us, states_prison, by = "state")

ggplot(data_map) +
  geom_sf(aes(fill = x1978)) +
  scale_fill_viridis_c(option = "plasma") +
  labs(title = "Rates of Incarceration in State Prisons  in 1978", 
       fill = "Incarceration\nper 100,000 people",
       caption = "Data from Sawyer (2018). https://www.prisonpolicy.org/reports/women_overtime_table_1.html") +
  theme_minimal()

```

